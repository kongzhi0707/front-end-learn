
### 浅谈前端数据模型

#### 一）定义

数据模型是数据特征的抽象，用来抽象定义一个业务对象。假如现在有一个用户模型，如果要抽象的描述这个用户对象，我们可以如下定义：

const UserModel = {
  name: {
    type: String,
    property: 'name',
    value: 'kongzhi'
  },
  age: {
    type: Number,
    property: 'age',
    value: 34
  }
};

如上，type声明数据的类型，property 指明映射路径，value 是默认值。

#### 二）解决了前端什么问题？

上面的数据模型和我们前端有什么关系呢？前端又不需要和数据库打交道，前端开发主要那个字段显示数据而已，那为什么需要数据模型呢？

#### 场景一

在我们前端开发中，我们通过ajax请求拿到服务端数据，然后将数据显示在视图上。经常会如下写代码：

<div>
  <span className="info">{{datas && datas.length && datas[0].xxx}}</span>
</div>

如上代码，我们要显示某个字段需要判断 datas 是否存在，是否有长度， 然后在取第一个数据。如果不这样判断，假如服务器端返回的datas为null的话， 在页面就会报错。

在这种场景下，我们在开发中就不得不写一些防疫性代码，久而久之，项目中类似这样的代码就会越来越多，如果碰到层级深的，防疫性代码就会越来越多。这种编码方式前端完全依赖与服务器端定义的数据结构，非常不利于后期维护。

#### 场景二

平时在开发中，我们拿到了服务器端返回的数据，有些不是标准格式的，是无法直接在视图上直接使用的，是需要格式化处理的。比如返回的时间是毫秒数，我们前端需要把它转换成
时间格式等。在这个时候我们的组件的生命周期内，就不得不而外增加一些对数据处理的逻辑。

#### 场景三

在用户做了一些交互后，我们需要点击保存按钮需要将一些数据存储到服务器端，这个时候我们拿到的数据往往是非标准的。因此在提交数据之前，我们需要对这些数据进行处理下开发需要的数据格式。还有就是有些接口参数是json字符串形式的，可能是多级嵌套的，我们还需要特意构造这样的参数数据格式，导致开发中编写了太多和业务无关的逻辑代码。
随着项目逐渐扩大或维护人员不断的更迭。项目会越来越不好维护。

#### 三）数据模型处理

在碰到上面这么多痛点之后，我们要如何解决上面的这些问题呢？总结下来有以下几个问题：

1）前后端数据结构没有解藕，前端在应对不定的服务器端数据结构的前提下，需要编写过多的保护性代码，不利于维护的同时，代码健壮性也不高。
2）基础数据逻辑处理没有和UI试图解藕，容易堵塞视图渲染，同时，在视图组件上存在太多的基础数据逻辑处理，没有有效复用。

因此我们需要引入数据模型的概念，通过数据模型来解决上面这些问题。

首先，我们可以在项目的对应目录下新建一个名叫 model的文件夹，专门用来存放模型的，比如定义的模型叫 卡片模型为 cardModel, 其中数据定义的格式如下：

1. type必填，用来描述该字段的类型，支持 String，Number，Date等类型。
2. property 必填，数据的路径，对应服务器端数据结构的取值路径。
3. value 选填，数据的默认值，可不填。

通过 new Model()进行初始化，后续我们需要通过 model.parse(data) 或 model.traverse(data) 这两个方法就可以完成正向映射和反向映射的过程。

实现的基本原理：

1）声明一个名叫Model的类。
2）通过 new Model(options), 传入模型结构，初始化数据模型属性，对外主要使用的是 parse 和 traverse 方法。
3）parse方法的实现过程就是遍历模型数据结构，拿到每个属性的数据路径，然后根据这个路径去取传入的数据里面的数据，最后给事先定义好的属性赋值。在赋值的过程中，可以根据
type格式化一些类似的时间，价格类型的数据。
4）traverse 方法刚好和 parse 相反，同样是遍历数据模型结构，拿到每个属性的数据路径，然后根据这个数据路径去设置一个新对象的值，反向格式化数据类型，最后返回这个新对象。






